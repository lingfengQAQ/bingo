"""配置中心 - 所有配置项集中管理"""
import os
from pathlib import Path

# ============== 环境变量 ==============
def require_env(name: str) -> str:
    """获取必需的环境变量"""
    value = os.environ.get(name)
    if not value:
        raise SystemExit(f"环境变量 {name} 是必需的")
    return value


# ============== LLM 配置 ==============
EMBED_DIM = 768
LLM_MODEL = "gemini-2.5-flash"
EMBED_MODEL = "models/gemini-embedding-001"

# 重试配置
MAX_EMBED_RETRIES = 5
MAX_LLM_RETRIES = 5
RATE_LIMIT_WAIT = 60  # 429 错误等待时间

# 并发控制
EMBED_CONCURRENCY = 2
LLM_CONCURRENCY = 3


# ============== 文档处理配置 ==============
# 超长章节分块阈值（字符数）
MAX_CHAPTER_LENGTH = 15000
# 分块重叠
CHUNK_OVERLAP = 500


# ============== 小说类型定义 ==============
# 主类型
GENRE_MAIN = {
    "玄幻": ["修仙", "修真", "修炼", "灵气", "丹药", "法宝", "飞升", "渡劫", "金丹", "元婴", "筑基", "炼气", "大能", "道友"],
    "言情": ["霸总", "甜宠", "豪门", "虐恋", "小娇妻", "总裁", "男神", "暖婚", "闪婚", "契约", "腹黑"],
    "武侠": ["江湖", "门派", "武林", "剑法", "内力", "轻功", "掌门", "侠客", "镖局", "武功"],
    "都市": ["重生都市", "商战", "娱乐圈", "职场", "医生", "律师", "特种兵", "兵王"],
    "科幻": ["星际", "机甲", "末世", "丧尸", "废土", "进化", "异能", "变异"],
    "历史": ["穿越历史", "宫斗", "宅斗", "朝堂", "权谋", "皇帝", "王爷", "嫡女"],
    "游戏": ["网游", "电竞", "游戏世界", "副本", "公会", "BOSS", "装备"],
    "悬疑": ["推理", "探案", "悬疑", "诡异", "灵异", "鬼怪", "盗墓"],
}

# 子类型/标签
GENRE_TAGS = {
    "穿越": ["穿越", "穿书", "快穿", "综穿"],
    "重生": ["重生", "重活", "回到过去", "重来"],
    "系统": ["系统", "金手指", "空间", "随身", "面板"],
    "无敌": ["无敌", "碾压", "秒杀", "一拳", "吊打"],
    "种田": ["种田", "发家致富", "经营", "建设"],
    "宫斗": ["宫斗", "宅斗", "后宫", "争宠"],
    "甜宠": ["甜宠", "宠溺", "独宠", "蜜恋"],
}

# 风格标签
STYLE_TAGS = {
    "热血": ["热血", "燃", "激动", "震撼", "壮烈"],
    "轻松": ["轻松", "搞笑", "日常", "欢乐", "沙雕"],
    "虐文": ["虐", "心痛", "悲剧", "泪目", "刀"],
    "爽文": ["爽", "打脸", "装逼", "碾压", "逆袭"],
    "慢热": ["慢热", "细腻", "铺垫", "文笔好"],
}


# ============== LightRAG 配置 ==============
# 自定义实体类型（用于知识图谱提取）
ENTITY_TYPES = [
    "人物",        # 角色名、称号
    "场景类型",    # 战斗、修炼、日常等
    "情节事件",    # 重要剧情节点
    "描写手法",    # 写作技巧
    "情感氛围",    # 紧张、温馨、悲伤等
    "小说类型",    # 玄幻、言情等
]


# ============== 路径配置 ==============
def get_paths() -> dict:
    """获取所有路径配置"""
    return {
        "gdrive_src": os.environ.get("GDRIVE_SRC", "gdrive:ebooks"),
        "gdrive_dst": os.environ.get("GDRIVE_DST", "gdrive:ebooks-db"),
        "local_src": Path(os.environ.get("LOCAL_SRC", "/data/input")),
        "local_db": Path(os.environ.get("LOCAL_DB", "/data/lightrag_db")),
    }


def is_force_reprocess() -> bool:
    """是否强制重新处理所有文件"""
    return os.environ.get("FORCE_REPROCESS", "").lower() == "true"
